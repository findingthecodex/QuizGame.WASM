@page "/quiz/oopadvanced/vecka2"


<div style="
    min-height: 90vh; 
    display: flex; 
    flex-direction: column; 
    align-items: center;
    padding-top: 1rem;">

    <!-- Topic -->
    <MudText Typo="Typo.h1" Align="Align.Center" Class="mb-4">
        OOP Advanced Vecka 2
    </MudText>
    
    <!-- Show Result -->
    <MudText Typo="Typo.h2" Align="Align.Center" Class="mb-4">
        @(currentQuestion + 1)/10
    </MudText>
    
    @if (showResult)
    {
        <MudCard Class="p-6" Style="max-width:500px; text-align:center; background-color: transparent">
            <MudText Typo="Typo.h2">ðŸŽ‰ Quiz Completed!</MudText>
            <MudText Typo="Typo.h3">
                Score: @score / 10
            </MudText>

            <MudButton Class="mt-4" OnClick="RestartQuiz">
                Play Again
            </MudButton>
        </MudCard>
    }
    else
    {
        <!-- HÃ¤r ligger ditt nuvarande quiz -->
    

    <!-- The Question -->
    <MudCard Class="p-4" Style="max-width:600px; margin: 1.5rem auto; text-align: center; background-color:transparent">

        <!-- Question -->
        <MudText Typo="Typo.h2" Class="mb-1">
            @questions[currentQuestion].Question
        </MudText>

        <!-- Info under question -->
        <MudText Typo="Typo.subtitle2"
                 Class="mb-3"
                 Style="
            font-weight:600;
            color:#00bfff;
            text-shadow:
              0 0 6px rgba(0,150,255,0.8),
              0 0 12px rgba(0,120,255,0.6),
              0 0 20px rgba(0,90,255,0.4);
         ">

            @(questions[currentQuestion].IsMultiChoice
                ? "VÃ¤lj alla som stÃ¤mmer"
                : "VÃ¤lj ett svar")

        </MudText>

        <!-- Answer choices -->
        <MudGrid Justify="Justify.Center" Spacing="2">

            @for (int i = 0; i < questions[currentQuestion].Answers.Count; i++)
            {
                var answer = questions[currentQuestion].Answers[i];
            
                <MudItem xs="6" class="d-flex justify-center" @key="answer">

                    <MudButton
                        Variant="Variant.Filled"
                        Color="Color.Primary"
                        Class="@GetButtonClass(answer)"
                        OnClick="@(() => SelectAnswer(answer))"
                        Disabled="@answered"
                        Style="
                    width: 220px;
                    height: 70px;
                    font-size: 1.2rem;
                    font-weight: 600;
                    border-radius: 16px;
                ">

                        @answer

                    </MudButton>

                </MudItem>
            }
        </MudGrid>
        
        @if (questions[currentQuestion].IsMultiChoice)
        {
            <MudButton
                Class="mt-4 submit-glow force-style"
                Variant="Variant.Filled"
                Color="Color.Inherit"
                DisableElevation="true"
                Disabled="@(answered || selectedAnswers.Count == 0)"
                OnClick="SubmitAnswer">

                Submit Answer
            </MudButton>
        }

        <!-- Correct or Wrong text -->
        @if (answered)
        {
            <MudText Typo="Typo.h2" Class="mt-3" Color="@feedbackColor">
                @feedbackMessage
            </MudText>

            <!-- Next Question button -->
            <MudButton 
                Class="mt-3"
                Variant="Variant.Filled"
                Color="Color.Primary"
                OnClick="NextQuestion"
                Style="
                        width: 180px;
                        height: 50px;
                        font-size: 1rem;
                        font-weight: 700;
                        border-radius: 20px;
                        box-shadow: 0 0 15px rgba(0,0,0,0.7);
                ">
                Next Question
            </MudButton>
        }
        
        

    </MudCard>

    <MudText Typo="Typo.subtitle1" Class="mt-4">
        Score: @score
    </MudText>
    }
    
</div>
    
<!-- Copyright lÃ¤ngst ner -->
<div style="
    margin-top: auto; 
    padding-bottom: 16px; 
    width: 100%;
    display: flex;
    justify-content: center;
    text-align: center;">
    
    <MudText Typo="Typo.caption" Color="Color.Secondary">
        Â© 2026 FindingTheCode. All rights reserved.
    </MudText>
</div>

@code {
    HashSet<string> selectedAnswers = new();

    int totalQuestions = 10;
    bool showResult = false;

    int currentQuestion = 0;
    int score = 0;
    bool answered = false;

    string feedbackMessage = "";
    Color feedbackColor = Color.Default;

    protected override void OnInitialized()
    {
        ShuffleQuestions();
    }

    /// <summary>
    ///  Shuffles Questions and answer buttons - multi answers
    /// </summary>
    void ShuffleQuestions()
    {
        var rnd = new Random();

        questions = questions
            .OrderBy(q => rnd.Next())
            .Select(q => new QuizQuestion
            {
                Question = q.Question,

                // Kopiera bÃ¥da (fÃ¶r sÃ¤kerhets skull)
                CorrectAnswers = q.CorrectAnswers.ToList(),

                Answers = q.Answers
                    .OrderBy(a => rnd.Next())
                    .ToList()
            })
            .Take(totalQuestions)
            .ToList();
    }

    List<QuizQuestion> questions = new()
{
    
    // Multi answer question
    new QuizQuestion
    {
        Question = "API-kontrakt â€“ kÃ¤rnkomponenter. Vilka ingÃ¥r?",
        Answers = new()
        {
            "Requestmodell",
            "Responsemodell",
            "Databasindex",
            "Statuskoder",
            "Versionshantering (Git)"
        },
        CorrectAnswers = new()
        {
            "Requestmodell",
            "Responsemodell",
            "Statuskoder"
        },
    },
    
    new QuizQuestion
    {
        Question = "POST â€“ korrekt HTTP-beteende vid skapande av resurs",
        Answers = new()
        {
            "Returnera 200 OK",
            "Returnera 201 Created",
            "Inkludera Location-header till ny resurs",
            "Inkludera Id till ny resurs",
            "Returnera 204 No Content"
        },
        CorrectAnswers = new()
        {
            "Returnera 201 Created",
            "Inkludera Location-header till ny resurs"
        }
    },
    
    new QuizQuestion
    {
        Question = "Minimal API â€“ vilka ansvar ska ligga i API-lagret?",
        Answers = new()
        {
            "Routing",
            "DomÃ¤nlogik",
            "Applikationsbeslut",
            "Statuskodsmappning",
            "DatabasÃ¥tkomst"
        },
        CorrectAnswers = new()
        {
            "Routing",
            "Statuskodsmappning"
        }
    },
    
    new QuizQuestion
    {
        Question = "EF Core â€“ vilka Ã¤r krav/rekommendationer fÃ¶r entiteter?",
        Answers = new()
        {
            "ParameterlÃ¶s konstruktor",
            "Navigation properties",
            "Public get/set",
            "Virtuella metoder fÃ¶r allt",
            "Flera arvshierarkier"
        },
        CorrectAnswers = new()
        {
            "ParameterlÃ¶s konstruktor",
            "Navigation properties",
            "Public get/set"
        }
    },
    
    // One answer question
    
    new QuizQuestion
    {
        Question = "Vilka hÃ¶r till 400 Bad Request?",
        Answers = new()
        {
            "Valideringsfel",
            "Resurs saknas",
            "Logisk konflikt",
            "Timeout",
            "Autentiseringskrav"
        },
        CorrectAnswers = new()
        {
            "Valideringsfel"
        }
    },
    
    new QuizQuestion
    {
        Question = "Vilka hÃ¶r till 404 Not Found?",
        Answers = new()
        {
            "Valideringsfel",
            "Resurs saknas",
            "Logisk konflikt",
            "Timeout",
            "Autentiseringskrav"
        },
        CorrectAnswers = new()
        {
            "Resurs saknas"
        }
    },
    
    new QuizQuestion
    {
        Question = "Vilka hÃ¶r till 409 Conflict?",
        Answers = new()
        {
            "Valideringsfel",
            "Resurs saknas",
            "Logisk konflikt",
            "Timeout",
            "Autentiseringskrav"
        },
        CorrectAnswers = new()
        {
            "Logisk konflikt"
        }
    },
    
    
    };

    
    void SelectAnswer(string answer)
    {
        if (answered)
            return;

        var question = questions[currentQuestion];

        if (!question.IsMultiChoice)
        {
            // SINGLE choice â†’ vÃ¤lj + rÃ¤tta direkt
            selectedAnswers.Clear();
            selectedAnswers.Add(answer);

            SubmitAnswer();
            return;
        }

        // MULTI choice â†’ toggle
        if (selectedAnswers.Contains(answer))
            selectedAnswers.Remove(answer);
        else
            selectedAnswers.Add(answer);

        StateHasChanged();
    }
    
    void NextQuestion()
    {
        answered = false;
        feedbackMessage = "";
        selectedAnswers.Clear();

        if (currentQuestion < questions.Count - 1)
            currentQuestion++;
        else
            showResult = true;
    }
    
    void RestartQuiz()
    {
        currentQuestion = 0;
        score = 0;
        showResult = false;
        ShuffleQuestions();
    }
    
    void SubmitAnswer()
    {
        answered = true;

        var correct = questions[currentQuestion].CorrectAnswers;

        bool isCorrect =
            selectedAnswers.Count == correct.Count &&
            selectedAnswers.All(a => correct.Contains(a));

        if (isCorrect)
        {
            score++;
            feedbackMessage = "Correct! ðŸŽ‰";
            feedbackColor = Color.Success;
        }
        else
        {
            var correctText = string.Join(", ", correct);

            feedbackMessage = $"Wrong ðŸ˜¢ Correct: {correctText}";
            feedbackColor = Color.Error;
        }
    }

    string GetButtonClass(string answer)
    {
        if (!answered)
            return selectedAnswers.Contains(answer) ? "glow-button glow-preselect" : "glow-button";

        // after submission
        var correct = questions[currentQuestion].CorrectAnswers.ToHashSet();

        if (correct.Contains(answer))
            return "glow-button glow-selected"; // correct

        if (selectedAnswers.Contains(answer) && !correct.Contains(answer))
            return "glow-button glow-wrong"; // wrongly selected

        return "glow-button";
    }
}
